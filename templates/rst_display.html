{% extends "layout.html" %}

{% import "utility.macros.j2" as utility %}
{% import "layout/macros.j2" as layout %}
{% import "content/macros.j2" as content %}
{% import "blog/macros.j2" as blog %}
{% import "events/macros.j2" as events %}


{% block title %}{{ rst.title }}{% endblock %}
{% block description %}{{ ctx.render_summary()|striptags or super() }}{% endblock %}


{% block og_url %}{{ get_full_canonical_url(ctx.builder, slug=ctx.slug) }}{% endblock %}
{% block og_description %}{{ ctx.render_summary()|striptags or super() }}{% endblock %}
{% block og_type %}{{ 'article' if ctx.pub_date else super() }}{% endblock %}
{% block twitter_type %}{{ 'summary_large_image' if ctx.config.image and ctx.config.image[0].src else super() }}{% endblock %}


{% block extra_og %}
  {% if ctx.pub_date %}
    <meta property="article:published_time" content="{{ ctx.pub_date.isoformat() }}" />
  {% endif %}
  {% if ctx.tags %}
    {% for tag in ctx.tags %}
      <meta property="article:tag" content="{{ tag }}" />
    {% endfor %}
  {% endif %}
{% endblock %}

{% block location -%}
  {%- if config.location -%}
    {{- config.location -}}
  {%- elif ctx.pub_date -%}
    {{ 'writing' }}
  {%- else -%}
    {%- set locations = config.nav|map(attribute='slug') -%}
    {% for slug in locations %}
      {{- slug if (slug in ctx.slug) else '' -}}
    {% endfor %}
  {%- endif -%}
{%- endblock %}

{% block body %}
  <div data-layout="intro" data-align="full" data-grid="full">
    {% block headline %}
      <h1 data-align="center"
        class="page-title{{ ' is-hidden' if config.hide_title else '' }}">
        {{ rst.title|typogrify }}
      </h1>
    {% endblock %}

    {% if config.summary %}
      <aside class="summary" data-align="center">
        {{ ctx.render_summary()|typogrify }}

        {% if config.elsewhere %}
          {% set where = config.elsewhere[0] %}
          {% set text = ['Read More on ', where.src]|join %}
          {{ content.btn(where.url, text) }}
        {% endif %}
      </aside>
    {% endif %}

    <hr data-layout="grid-border" />
  </div>

  {% set image = config.image[0] if config.image else none %}
  {% if image %}
    <figure data-layout="hero" data-align="full" data-grid="full">
      <img src="/static/pictures/{{ image.src }}"
        alt="{{ image.alt or '' }}"
        data-align="center-left"
        class="hero-image">
      {% if image.caption %}
        <figcaption class="hero-caption" data-align="right-edge">
          <span class="caption-wrap">{{ image.caption|typogrify }}</span>
        </figcaption>
      {% endif %}
    </figure>
  {% endif %}

  {%- for module in config.before -%}
    {% include module.include %}
  {%- endfor -%}

  {% if ctx.pub_date %}
    {{ blog.byline(ctx) }}
  {% endif %}

  {% if rst.fragment %}
    <div
      data-layout="rst"
      data-align="{{ config.align or 'center' }}"
      {{ utility.attr_if('data-grid', config.grid) }}
      {{ utility.attr_if('data-erasure', config.erasure) }} >

      {% if config.tagline %}
        <h2 class="page-tagline">{{ config.tagline|typogrify }}</h2>
      {% endif %}

      {{ rst.fragment|typogrify }}
    </div>
  {% endif %}

  {%- for module in config.after -%}
    {% include module.include %}
  {%- endfor -%}

  {% if config.series %}
    {% set entries = get_blog_entries_by_tag(config.series)|reverse %}
    {{ blog.section(
      entries,
      title="Related Articles"
    ) }}
  {% endif %}
{% endblock %}
