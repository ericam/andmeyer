{% import "utility.macros.j2" as utility %}
{% import "icon.macros.j2" as icon %}


{% macro section(entries) %}
  <section data-grid="posts">
    {% for entry in entries %}
      {{ list(entry) }}
    {% endfor %}
  </section>
{% endmacro %}


{% macro list(post) %}
<article class="post">
  {% set away = post.config.elsewhere[0] if post.config.elsewhere else none %}

  {{ byline(post, away) }}

  <h2 class="post-title">
    <a href="{{ away.url or link_to('page', slug=post.slug) }}">
      {{ post.title|typogrify }}
    </a>
  </h2>

  {% if post.summary %}
    {{ post.render_summary()|typogrify }}
  {% endif %}
</article>
{% endmacro %}


{% macro byline(post, away=none) %}
<div class="byline">
  {{ pubdate(post.pub_date) }}

  {% set series = post.config.series %}

  {% if away or series %}
    [
      {% if series %}
        {% set series_url = ['/tags/', series|urlencode, '/']|join %}
        {% set series_page = post.config.series_pages|selectattr('title', 'equalto', series)|list %}
        {% set series_url = series_page[0].url if series_page[0] else series_url %}
        {{ utility.link_if(icon.get('list') + series|typogrify, series_url) }}
      {% endif %}
      {% if away and series %}::{% endif %}
      {% if away %}
        {{ utility.link_if(icon.get('newtab') + away.src|typogrify, away.url) }}
      {% endif %}
    ]
  {% endif %}
</div>
{% endmacro %}


{% macro pubdate(pub_date) %}
  {% if pub_date %}
    {% if pub_date %}
    <time datetime="{{ pub_date.isoformat() }}" pubdate="pubdate">
      {{ pub_date.strftime("%B %d, %Y") }}
    </time>
    {% endif %}
  {% endif %}
{% endmacro %}


{% macro tags(taglist) %}
  {% if taglist %}
    in
    <span class="tags">
      {% for tag in taglist|sort(case_sensitive=true) %}
        {%- if not loop.first %}, {% endif -%}
        <a href="{{ link_to('tag', tag=tag) }}" rel="tag">{{ tag }}</a>
      {%- endfor %}
    </span>
  {% endif %}
{% endmacro %}
